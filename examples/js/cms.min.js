/*! @chrisdiana/cmsjs v2.0.1~cdp1337-20221105 | MIT (c) 2022 Chris Diana | https://github.com/chrisdiana/cms.js */
var CMS=function(){"use strict";function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function t(e,t,i){if(t)n(e.prototype,t);if(i)n(e,i);Object.defineProperty(e,"prototype",{writable:false});return e}var r={elementId:null,layoutDirectory:null,defaultView:null,errorLayout:null,mode:"SERVER",github:null,types:[],plugins:[],frontMatterSeperator:/^---$/m,listAttributes:["tags"],dateParser:/\d{4}-\d{2}(?:-\d{2})?/,dateFormat:function e(t){return[t.getMonth()+1,t.getDate(),t.getFullYear()].join("/")},extension:".md",sort:undefined,markdownEngine:null,debug:false,messageClassName:"cms-messages",onload:function e(){},onroute:function e(){},webpath:"/",titleSearchResults:"Search Results"};var i;var s={NO_FILES_ERROR:"ERROR: No files in directory",ELEMENT_ID_ERROR:'ERROR: No element ID or ID incorrect. Check "elementId" parameter in config.',DIRECTORY_ERROR:"ERROR: Error getting files. Make sure there is a directory for each type in config with files in it.",GET_FILE_ERROR:"ERROR: Error getting the file",LAYOUT_LOAD_ERROR:"ERROR: Error loading layout. Check the layout file to make sure it exists.",NOT_READY_WARNING:"WARNING: Not ready to perform action"};function a(e){i=document.createElement("div");i.className=e;i.innerHTML="DEBUG";i.style.background="yellow";i.style.position="absolute";i.style.top="0px";document.body.appendChild(i)}function l(e,t){if(e)i.innerHTML=t;return t}function u(e,t){var i=new XMLHttpRequest;i.open("GET",e,true);i.onreadystatechange=function(){if(i.readyState===4){if(i.status===200){t(i.response,false,i.getResponseHeader("Last-Modified"))}else{t(i,i.statusText,null)}}};i.send()}function c(e,t,i){var n;if(typeof t==="undefined"){t=e}for(n in t){if(Object.prototype.hasOwnProperty.call(t,n)){e[n]=t[n]}}if(i){i()}return e}function f(e){var t=e.toString();t=t.substr("function ".length);t=t.substr(0,t.indexOf("("));return t}function h(e,t){if(e){var i=e.split(".").pop();return i===t.replace(".","")||i==="html"?true:false}}function g(e,t){if(!t)t=window.location.href;e=e.replace(/[[]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=i.exec(t);if(!n)return null;if(!n[2])return"";return decodeURIComponent(n[2].replace(/\+/g," "))}function d(e,t){var i=[t.host,"repos",t.username,t.repo,"contents",e+"?ref="+t.branch];if(t.prefix)i.splice(5,0,t.prefix);return i.join("/")}function p(e){var t=new Date(e);return new Date(t.getTime()-t.getTimezoneOffset()*-6e4)}function m(e){return e.split("\\").pop()}function y(e){return new Function("data","var output="+JSON.stringify(e).replace(/<%=(.+?)%>/g,'"+($1)+"').replace(/<%(.+?)%>/g,'";$1\noutput+="')+";return output;")}function v(e,i,n){u(e,function(e,t){if(t)n(e,t);n(y(e)(i),t)})}function R(e,i,t,n){i.container.innerHTML="";var r=[i.webpath,"/",i.layoutDirectory,"/",e,".html"].join("");v(r,t,function(e,t){if(t){l(s["LAYOUT_LOAD_ERROR"]);n(null,t)}else{i.container.innerHTML=e;n("rendered",null)}})}var b=function(){function e(){o(this,e);this.rules=[{regex:/(#+)(.*)/g,replacement:function e(t,i,n){var r=i.length;return"<h"+r+">"+n.trim()+"</h"+r+">"}},{regex:/!\[([^[]+)\]\(([^)]+)\)/g,replacement:"<img src='$2' alt='$1'>"},{regex:/\[([^[]+)\]\(([^)]+)\)/g,replacement:"<a href='$2'>$1</a>"},{regex:/(\*\*|__)(.*?)\1/g,replacement:"<strong>$2</strong>"},{regex:/(\*|_)(.*?)\1/g,replacement:"<em>$2</em>"},{regex:/~~(.*?)~~/g,replacement:"<del>$1</del>"},{regex:/:"(.*?)":/g,replacement:"<q>$1</q>"},{regex:/```[a-z]*\n[\s\S]*?\n```/g,replacement:function e(t){t=t.replace(/```/gm,"");return"<pre>"+t.trim()+"</pre>"}},{regex:/&&&[a-z]*\n[\s\S]*?\n&&&/g,replacement:function e(t){t=t.replace(/```/gm,"");return'<script type="text/javascript">'+t.trim()+"<\/script>"}},{regex:/`(.*?)`/g,replacement:"<code>$1</code>"},{regex:/\n\*(.*)/g,replacement:function e(t,i){return"\n<ul>\n\t<li>"+i.trim()+"</li>\n</ul>"}},{regex:/\n[0-9]+\.(.*)/g,replacement:function e(t,i){return"\n<ol>\n\t<li>"+i.trim()+"</li>\n</ol>"}},{regex:/\n(&gt;|>)(.*)/g,replacement:function e(t,i,n){return"\n<blockquote>"+n.trim()+"</blockquote>"}},{regex:/\n-{5,}/g,replacement:"\n<hr />"},{regex:/\n([^\n]+)\n/g,replacement:function e(t,i){var n=i.trim();if(/^<\/?(ul|ol|li|h|p|bl)/i.test(n)){return"\n"+i+"\n"}return"\n<p>"+n+"</p>\n"}},{regex:/<\/ul>\s?<ul>/g,replacement:""},{regex:/<\/ol>\s?<ol>/g,replacement:""},{regex:/<\/blockquote><blockquote>/g,replacement:"\n"}]}t(e,[{key:"render",value:function e(t){t="\n"+t+"\n";this.rules.forEach(function(e){t=t.replace(e.regex,e.replacement)});return t.trim()}}]);return e}();var E=function(){function r(e,t,i,n){o(this,r);this.url=e;this.type=t;this.layout=i;this.config=n;this.html=false;this.content;this.name;this.extension;this.title;this.seotitle;this.excerpt;this.date;this.datetime;this.author;this.body;this.permalink;this.tags;this.image}t(r,[{key:"getContent",value:function e(n){var r=this;u(this.url,function(e,t,i){if(t)n(e,t);r.content=e;if(i){r.datetime=i}if(typeof r.content==="string"){n(e,t)}})}},{key:"parseFrontMatter",value:function e(){var t=this.content.split(this.config.frontMatterSeperator)[1];if(t){var r={};t.split(/\n/g).forEach(function(e){if(e.indexOf(":")!==-1){var t=e.indexOf(":"),i=e.substr(0,t).trim(),n=e.substr(t+1).trim();if(n!==""){r[i]=n}}});c(this,r,null)}}},{key:"setListAttributes",value:function e(){var t=this;this.config.listAttributes.forEach(function(e){if(Object.getOwnPropertyDescriptor(t,e)&&t[e]){t[e]=t[e].split(",").map(function(e){return e.trim()})}})}},{key:"setFilename",value:function e(){this.name=this.url.substr(this.url.lastIndexOf("/")).replace("/","").replace(this.config.extension,"")}},{key:"setPermalink",value:function e(){this.permalink=this.config.mode==="GITHUB"?["#",this.type,this.name].join("/"):this.url.substring(0,this.url.length-this.config.extension.length)+".html"}},{key:"setDate",value:function e(){var t=new RegExp(this.config.dateParser);if(this.date){this.datetime=p(this.date);this.date=this.config.dateFormat(this.datetime)}else if(t.test(this.url)){this.date=t.exec(this.url)[0];this.datetime=p(this.date);this.date=this.config.dateFormat(this.datetime)}else if(this.datetime){this.datetime=p(this.datetime);this.date=this.config.dateFormat(this.datetime)}}},{key:"setBody",value:function e(){var t=this.content.split(this.config.frontMatterSeperator).splice(2).join(this.config.frontMatterSeperator);if(this.html){this.body=t}else{if(this.config.markdownEngine){this.body=this.config.markdownEngine(t)}else{var i=new b;this.body=i.render(t)}}}},{key:"parseContent",value:function e(){this.setFilename();this.setPermalink();this.parseFrontMatter();this.setListAttributes();this.setDate();this.setBody()}},{key:"matchesSearch",value:function e(t){var i=this;var n=t.toLowerCase().split(" "),r=true;n.forEach(function(e){if(i.content.toLowerCase().indexOf(e)===-1&&i.title.toLowerCase().indexOf(e)===-1){r=false;return false}});return r}},{key:"render",value:function e(t){if(this.seotitle){document.title=this.seotitle}else if(this.title){document.title=this.title}else{document.title="Page"}return R(this.layout,this.config,this,t)}}]);return r}();var k=function(){function n(e,t,i){o(this,n);this.type=e;this.layout=t;this.config=i;this.files=[];this.directories=[];this[e]=this.files;this.directoriesScanned=0}t(n,[{key:"debuglog",value:function e(){if(this.config.debug){var t;(t=console).log.apply(t,arguments)}}},{key:"init",value:function e(i){var n=this;this.getFiles(function(e,t){if(t)l(s["DIRECTORY_ERROR"]);n.loadFiles(function(e,t){if(t)l(s["GET_FILE_ERROR"]);i()})})}},{key:"getFileListUrl",value:function e(t,i){return i.mode==="GITHUB"?d(t,i.github):this.config.webpath+t}},{key:"getFileUrl",value:function e(t,i,n){if(i==="GITHUB"){return t["download_url"]}else{var r=m(t.getAttribute("href"));if(r[0]==="/"){return r}else{if(n[n.length-1]==="/"){return n+r}else{return n+"/"+r}}}}},{key:"getFileElements",value:function e(t){var i;if(this.config.mode==="GITHUB"){i=JSON.parse(t)}else{var n=document.createElement("div");n.innerHTML=t;i=[].slice.call(n.getElementsByTagName("a"))}return i}},{key:"getFiles",value:function e(t){this.directories=[this.getFileListUrl(this.type,this.config)];this.scanDirectory(t,this.directories[0],true)}},{key:"scanDirectory",value:function e(i,n,r){var o=this;this.debuglog("Scanning directory",n);u(n,function(e,t){if(t)i(e,t);o.getFileElements(e).forEach(function(e){var t=o.getFileUrl(e,o.config.mode,n);if(h(t,o.config.extension)){o.files.push(new E(t,o.type,o.layout.single,o.config))}else if(r&&o.config.mode!=="GITHUB"&&t[t.length-1]==="/"&&t!==o.config.webpath){o.directories.push(t);o.scanDirectory(i,t,false)}});o.directoriesScanned++;if(o.directoriesScanned===o.directories.length){i(e,t)}})}},{key:"loadFiles",value:function e(r){var o=this;var s=[];this.files.forEach(function(i,n){i.getContent(function(e,t){if(t)r(e,t);s.push(n);i.parseContent();if(o.files.length==s.length){r(e,t)}})})}},{key:"search",value:function e(t){this[this.type]=this.files.filter(function(e){return e.matchesSearch(t)})}},{key:"resetSearch",value:function e(){this[this.type]=this.files}},{key:"getByTag",value:function e(t){this[this.type]=this.files.filter(function(e){if(t&&e.tags){return e.tags.some(function(e){return e===t})}})}},{key:"getTags",value:function e(){var i=[],n=[];this.files.forEach(function(e){if(e.tags){e.tags.forEach(function(e){var t=n.indexOf(e);if(t===-1){i.push({name:e,count:1});n.push(e)}else{i[t].count++}})}});return i}},{key:"getFileByPermalink",value:function e(t){var i=this;this.debuglog("Retrieving file by permalink",t);var n=this.files.filter(function(e){return e.permalink===t||e.permalink===i.config.webpath+t});if(n.length===0){throw"Requested file could not be located"}return n[0]}},{key:"render",value:function e(t){if(this.layout.title){document.title=this.layout.title}else{document.title="Listing"}return R(this.layout.list,this.config,this,t)}}]);return n}();var w=function(){function i(e,t){o(this,i);this.ready=false;this.collections={};this.filteredCollections={};this.state;this.view=e;this.config=Object.assign({},r,t)}t(i,[{key:"debuglog",value:function e(){if(this.config.debug){var t;(t=console).log.apply(t,arguments)}}},{key:"init",value:function e(){var t=this;if(this.config.debug){a(this.config.messageClassName)}if(this.config.elementId){this.config.container=document.getElementById(this.config.elementId);this.view.addEventListener("click",function(e){if(e.target&&e.target.nodeName==="A"){t.listenerLinkClick(e)}});if(this.config.container){this.initFileCollections(function(){t.view.addEventListener("hashchange",t.route.bind(t),false);t.view.addEventListener("popstate",function(e){console.log("popping",e);t.route()});t.route();t.ready=true;t.registerPlugins();t.onload()})}else{l(this.config.debug,s["ELEMENT_ID_ERROR"])}}else{l(this.config.debug,s["ELEMENT_ID_ERROR"])}}},{key:"listenerLinkClick",value:function e(t){var i=this;var n=t.target.href;this.config.types.forEach(function(e){if(n.indexOf(window.location.origin+i.config.webpath+e.name+"/")===0&&n.substring(n.length-5)===".html"){i.historyPushState(n);t.preventDefault();return false}if(n.indexOf(window.location.origin+i.config.webpath+e.name+".html")===0){i.historyPushState(n);t.preventDefault();return false}});if(n===window.location.origin+this.config.webpath){this.historyPushState(n);t.preventDefault();return false}console.log(n);t.preventDefault()}},{key:"onload",value:function e(){this.config.onload()}},{key:"onroute",value:function e(){this.config.onroute()}},{key:"initFileCollections",value:function e(i){var n=this;var r=[];var o=[];this.config.types.forEach(function(e){n.collections[e.name]=new k(e.name,e.layout,n.config);o.push(e.name)});o.forEach(function(e,t){n.collections[e].init(function(){n.debuglog("Initialized collection "+e);r.push(t);if(e.indexOf("post")===0){n.collections[e][e].reverse()}if(o.length==r.length){i()}})})}},{key:"getPathsFromURL",value:function e(){var t=window.location.pathname.substring(this.config.webpath.length).split("/");if(t.length>=1&&t[0].substring(t[0].length-5)===".html"){t[0]=t[0].substring(0,t[0].length-5)}return t}},{key:"historyReplaceState",value:function e(t){window.history.replaceState({},"",t);this.route()}},{key:"historyPushState",value:function e(t){window.history.pushState({},"",t);this.route()}},{key:"route",value:function e(){var t=this;this.debuglog("Initializing routing");var i=this.getPathsFromURL(),n=i[0],r=i.splice(1).join("/"),o=this.collections[n],s=g("s")||"",a=g("tag")||"",l="",u=null;this.debuglog("Paths retrieved from URL:",{type:n,filename:r,collection:o});this.state=window.location.hash.substr(1);if(!n){this.historyReplaceState(this.config.webpath+this.config.defaultView+".html");return}else{try{if(r){u=o.getFileByPermalink([n,r.trim()].join("/"));l="single";u.render(function(){t.onroute({type:n,file:u,mode:l,query:s,tag:a,collection:o})})}else if(o){if(s){o.search(s)}else if(a){o.getByTag(a)}else{o.resetSearch()}l="listing";o.render(function(){t.onroute({type:n,file:u,mode:l,query:s,tag:a,collection:o})})}else{throw"Unknown request"}}catch(e){console.error(e);R(this.config.errorLayout,this.config,{},function(){t.onroute({type:n,file:u,mode:l,query:s,tag:a,collection:o})});l="error"}}}},{key:"registerPlugins",value:function e(){var i=this;this.config.plugins.forEach(function(e){var t=f(e);if(!i[t]){i[t]=e}})}},{key:"sort",value:function e(t,i){if(this.ready){this.collections[t][t].sort(i);this.collections[t].render()}else{l(s["NOT_READY_WARNING"])}}},{key:"search",value:function e(t,i){this.historyPushState(this.config.webpath+t+".html?s="+encodeURIComponent(i))}}]);return i}();var e=function(e){return new w(window,e)};return e}();